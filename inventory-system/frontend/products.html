<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="icon" type="image/jpeg" href="logo.jpeg">
<title>Products - Inventory System</title>
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
<style>
/* Reset */
* { margin: 0; padding: 0; box-sizing: border-box; }

/* Body styling */
body {
    font-family: 'Roboto', sans-serif;
    background: linear-gradient(135deg, #6a11cb, #2575fc);
    min-height: 100vh;
    display: flex;
    justify-content: center;
    align-items: center;
    padding: 20px;
}

/* Products container */
.products-container {
    background: #fff;
    padding: 30px 40px;
    border-radius: 20px;
    box-shadow: 0 12px 30px rgba(0,0,0,0.3);
    width: 100%;
    max-width: 950px;
    text-align: center;
}

.products-container h2 { margin-bottom: 20px; color: #333; }

.form-section {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    justify-content: center;
    align-items: center;
    margin-bottom: 20px;
}

.form-section input, .form-section button {
    padding: 10px;
    border-radius: 8px;
    border: 1px solid #ccc;
    font-size: 16px;
}

/* Custom file input */
.file-input-wrapper {
    position: relative;
    width: 150px; /* same width as other inputs */
}

.file-input-wrapper input[type="file"] {
    opacity: 0;
    position: absolute;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    cursor: pointer;
}

.file-input-wrapper button {
    width: 100%;
    padding: 10px;
    border-radius: 8px;
    border: 1px solid #ccc;
    background: #fff;
    font-size: 16px;
    text-align: left;
    cursor: pointer;
    transition: 0.2s ease;
}

.file-input-wrapper button:hover {
    background: #f0f0f0;
}

.form-section button.add-btn {
    background: #2575fc;
    color: #fff;
    border: none;
    font-weight: bold;
    transition: 0.2s ease;
}

.form-section button.add-btn:hover {
    background: #1a5bd8;
}

table {
    width: 100%;
    border-collapse: collapse;
    margin-bottom: 20px;
}

table th, table td {
    padding: 10px;
    border: 1px solid #ccc;
    text-align: center;
}

table th { background: #2575fc; color: #fff; }

table img { width: 50px; height: 50px; object-fit: cover; border-radius: 5px; }

.products-container > button {
    padding: 12px 25px;
    border: none;
    border-radius: 8px;
    background: #2575fc;
    color: #fff;
    font-weight: bold;
    cursor: pointer;
}
</style>
</head>
<body>

<div class="products-container">
  <h2>Products</h2>

  <div class="form-section">
    <div class="file-input-wrapper">
      <button type="button" id="fileBtn">Choose Image</button>
      <input type="file" id="image" />
    </div>
    <input type="text" id="name" placeholder="Product Name" />   
    <input type="text" id="description" placeholder="Description" />
    <input type="number" id="quantity" placeholder="Quantity" />
    <input type="number" id="price" placeholder="Price" step="0.01" />    
    <button id="addProductBtn" class="add-btn">Add Product</button>
  </div>

  <table id="productsTable">
    <thead>
      <tr>
        <th>ID</th>
        <th>Name</th>
        <th>Description</th>
        <th>Quantity</th>
        <th>Price</th>
        <th>Image</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <button onclick="window.location.href='dashboard.html'">Back to Dashboard</button>
</div>

<script>
const API_URL = "http://localhost:5000/api/products"; // change port if needed

let products = [];

// Fetch products from backend + store locally
async function loadProducts() {
    const res = await fetch(API_URL);
    products = await res.json();
    localStorage.setItem('products', JSON.stringify(products));
    renderProducts();
}

// Render products on table
function renderProducts() {
    const tbody = document.querySelector('#productsTable tbody');
    tbody.innerHTML = '';
    products.forEach((prod, index) => {
        tbody.innerHTML += `
            <tr>
                <td>${index + 1}</td>
                <td>${prod.name}</td>
                <td>${prod.description}</td>
                <td>${prod.quantity}</td>
                <td>${prod.price}</td>
                <td><img src="${prod.image}" alt="Product" width="60"></td>
                <td><button onclick="deleteProduct(${prod.id})">Delete</button></td>
            </tr>
        `;
    });
}

// Delete product
async function deleteProduct(id) {
    if (!confirm("Are you sure you want to delete this product?")) return;
    
    await fetch(`${API_URL}/${id}`, { method: 'DELETE' });

    // Remove locally
    products = products.filter(p => p.id !== id);
    localStorage.setItem('products', JSON.stringify(products));
    renderProducts();
}

// Add product
document.getElementById('addProductBtn').addEventListener('click', async () => {
    const name = document.getElementById('name').value;
    const description = document.getElementById('description').value;
    const quantity = document.getElementById('quantity').value;
    const price = document.getElementById('price').value;
    const imageFile = document.getElementById('image').files[0];

    if (!name || !description || !quantity || !price || !imageFile) {
        alert('All fields including image are required!');
        return;
    }

    // Upload image and product data to backend
    const formData = new FormData();
    formData.append('name', name);
    formData.append('description', description);
    formData.append('quantity', quantity);
    formData.append('price', price);
    formData.append('image', imageFile);

    const res = await fetch(API_URL, {
        method: 'POST',
        body: formData
    });

    const result = await res.json();
    if (result.error) {
        alert("Error adding product: " + result.error);
        return;
    }

    // Re-fetch updated list from backend
    await loadProducts();

    // Clear input fields
    document.getElementById('name').value = '';
    document.getElementById('description').value = '';
    document.getElementById('quantity').value = '';
    document.getElementById('price').value = '';
    document.getElementById('image').value = '';
    document.getElementById('fileBtn').textContent = "Choose Image";
});

// File input button behavior
const fileInput = document.getElementById('image');
const fileBtn = document.getElementById('fileBtn');

fileBtn.addEventListener('click', () => fileInput.click());
fileInput.addEventListener('change', () => {
    fileBtn.textContent = fileInput.files.length > 0 ? "File Selected" : "Choose Image";
});

// Initial load
loadProducts();
</script>

</body>
</html>
